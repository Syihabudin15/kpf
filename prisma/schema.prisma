// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum EStatusDapem {
  DRAFT
  PENDING
  SETUJU
  TOLAK
}

enum EStatusFinal {
  PENDING
  PROSES
  TRANSFER
  LUNAS
  GAGAL
}

enum EStatusBerkas {
  DEBITUR
  CABANG
  PUSAT
  SUMDAN
  SENDING
}

enum EStatusPKWT {
  BARU
  LANJUT
  TETAP
}

model Role {
  id          String @id
  name        String
  permissions String @db.Text

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Users      User[]
}

model User {
  id          String       @id @default(uuid())
  name        String
  username    String       @unique
  password    String
  nip         String?
  email       String?
  alamat      String?
  no_telp     String
  posisi      String?
  status_pkwt EStatusPKWT? @default(BARU)
  mulai_pkwt  DateTime?    @default(now())
  masa_pkwt   Int?         @default(3)
  target      Int?         @default(0)
  picture     String?

  CreatedDapems   Dapem[]        @relation("CreateDapemRelation")
  AODapems        Dapem[]        @relation("AODapemRelation")
  Cabang          Cabang?        @relation(fields: [cabangId], references: [id])
  Role            Role           @relation(fields: [roleId], references: [id])
  Sumdan          Sumdan?        @relation(fields: [sumdanId], references: [id])
  AgentFronting   AgentFronting? @relation(fields: [agentFrontingId], references: [id])
  cabangId        String?
  roleId          String
  sumdanId        String?
  agentFrontingId String?

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
}

model Area {
  id   String @id
  name String
  code String

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Cabangs    Cabang[]
}

model Cabang {
  id      String  @id
  name    String
  no_telp String?
  email   String?
  alamat  String?

  Area       Area     @relation(fields: [areaId], references: [id])
  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Users      User[]
  areaId     String
}

model Sumdan {
  id          String  @id
  name        String
  code        String
  alamat      String?
  no_telp     String?
  logo        String?
  description String? @db.Text
  tbo         Float   @default(3)
  sk_akad     String? @db.Text
  file_pks    String?

  c_margin   Float @default(0)
  c_admim    Float @default(0)
  c_rekening Int   @default(0)
  rounded    Int   @default(0)
  dsr        Float @default(0)

  status     Boolean    @default(true)
  created_at DateTime   @default(now())
  updated_at DateTime   @default(now())
  ProPems    ProPem[]
  TTPBs      TTPB[]
  TTPJs      TTPJ[]
  Droppings  Dropping[]
  Users      User[]
}

model ProPem {
  id            String @id
  name          String
  c_margin      Float  @default(0)
  c_admim       Float  @default(0)
  c_asuransi    Float  @default(0)
  c_tatalaksana Int    @default(0)
  c_materai     Int    @default(0)
  c_informasi   Int    @default(0)
  max_tenor     Int    @default(0)
  max_plafond   Int    @default(0)
  min_usia      Int    @default(0)
  max_usia      Int    @default(0)
  usia_lunas    Int    @default(0)

  Sumdan     Sumdan   @relation(fields: [sumdanId], references: [id])
  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  sumdanId   String
  Dapems     Dapem[]
}

model JePem {
  id               String  @id
  name             String
  blokir           Int
  c_mutasi         Int     @default(0)
  status_pelunasan Boolean @default(false)
  status_mutasi    Boolean @default(false)

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Dapems     Dapem[]
}

model Asuransi {
  id          String  @id
  name        String
  description String? @db.Text
  file_pks    String?

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Dapems     Dapem[]
}

model Debitur {
  nopen                 String    @unique
  gaji_pensiun          Int
  nama_penerima         String
  tgl_lahir_penerima    DateTime
  tempat_lahir          String?
  alm_peserta           String?
  kelurahan             String?
  kecamatan             String?
  kota                  String?
  provinsi              String?
  kode_pos              String?
  kantor_bayar          String?
  tmt_pensiun           DateTime?
  no_skep               String?
  tgl_skep              DateTime?
  nama_skep             String?
  kode_jiwa             String?
  penerbit_skep         String?
  npwp                  String?
  no_telp               String?
  pangkat               String?
  awal_flagging         DateTime?
  akhir_flagging        DateTime?
  mitra_flagging        String?
  kelompok_pensiun      String?
  masa_kerja            Int?
  pendidikan            String?
  jenis_kelamin         String?
  agama                 String?
  nik                   String?
  geo_location          String?
  d_alm_peserta         String?
  d_kelurahan           String?
  d_kecamatan           String?
  d_kota                String?
  d_provinsi            String?
  d_kode_pos            String?
  status_rumah          String?
  menempati_rumah       String?
  pekerjaan             String?
  alm_pekerjaan         String?
  ibu_kandung           String?
  jenis_usaha           String?
  status_kawin          String?
  bank                  String?
  norek                 String?
  masa_ktp              DateTime?
  nama_pasangan         String?
  tempat_lahir_pasangan String?
  tgl_lahir_pasangan    String?
  nik_pasangan          String?
  masa_ktp_pasangan     String?
  pekerjaan_pasangan    String?
  nama_keluarga         String?
  hubungan_keluarga     String?
  no_telp_keluarga      String?
  alamat_keluarga       String?   @db.Text
  Dapems                Dapem[]
}

model Dapem {
  id               String        @id
  plafond          Int
  tenor            Int
  margin           Float
  margin_sumdan    Float
  c_adm            Float
  c_adm_sumdan     Float
  c_asuransi       Float
  c_tatalaksana    Int
  c_materai        Int
  c_rekening       Int
  c_mutasi         Int
  c_blokir         Int
  c_pelunasan      Int
  status_final     EStatusFinal  @default(PENDING)
  final_at         DateTime?
  verif_status     EStatusDapem?
  verif_desc       String?       @db.Text
  verif_date       DateTime?
  slik_status      EStatusDapem?
  slik_date        DateTime?
  slik_desc        String?       @db.Text
  approv_status    EStatusDapem?
  approv_date      DateTime?
  approv_desc      String?       @db.Text
  pelunasan_status EStatusDapem?
  pelunasan_date   DateTime?
  pelunasan_ke     String?
  mutasi_status    EStatusDapem?
  mutasi_date      DateTime?
  mutasi_from      String?
  mutasi_ke        String?
  tbo              Int
  penggunaan       String?
  pembulatan       Int
  berkas_status    EStatusBerkas @default(CABANG)
  jaminan_status   EStatusBerkas @default(CABANG)
  akad_nomor       String?
  akad_date        DateTime?

  file_pelunasan   String?
  file_mutasi      String?
  file_slik        String?
  file_pengajuan   String?
  file_wawancara   String?
  file_asuransi    String?
  file_akad        String?
  file_pencairan   String?
  video_pencairan  String?
  video_pencairan2 String?
  video_pencairan3 String?

  Debitur       Debitur        @relation(fields: [nopen], references: [nopen])
  ProPem        ProPem         @relation(fields: [proPemId], references: [id])
  JePem         JePem          @relation(fields: [jePemId], references: [id])
  AO            User           @relation("AODapemRelation", fields: [aoId], references: [id])
  CreatedBy     User           @relation("CreateDapemRelation", fields: [createdById], references: [id])
  Dropping      Dropping?      @relation(fields: [droppingId], references: [id])
  Angsurans     Angsuran[]
  Pelunasan     Pelunasan?
  TTPB          TTPB?          @relation(fields: [tTPBId], references: [id])
  TTPJ          TTPJ?          @relation(fields: [tTPJId], references: [id])
  Asuransi      Asuransi       @relation(fields: [asuransiId], references: [id])
  AgentFronting AgentFronting? @relation(fields: [agentFrontingId], references: [id])

  nopen           String
  proPemId        String
  jePemId         String
  aoId            String
  createdById     String
  droppingId      String?
  tTPBId          String?
  tTPJId          String?
  asuransiId      String
  agentFrontingId String?

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
}

model Angsuran {
  id           String    @id
  ke           Int
  jadwal_bayar DateTime
  tgl_bayar    DateTime?
  pokok        Int
  margin       Int
  sisa         Int
  Dapem        Dapem     @relation(fields: [dapemId], references: [id])
  dapemId      String
}

model Dropping {
  id              String       @id
  dropping_status EStatusFinal @default(PENDING)
  dropping_date   DateTime?
  file_si         String?
  file_proof      String?

  Sumdan   Sumdan  @relation(fields: [sumdanId], references: [id])
  sumdanId String
  Dapems   Dapem[]

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
}

model TTPB {
  id            String        @id
  berkas_status EStatusBerkas @default(SENDING)
  berkas_date   DateTime?
  file_si       String?
  file_proof    String?

  Sumdan   Sumdan  @relation(fields: [sumdanId], references: [id])
  sumdanId String
  Dapem    Dapem[]

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
}

model TTPJ {
  id             String        @id
  jaminan_status EStatusBerkas @default(SENDING)
  jaminan_date   DateTime?
  file_si        String?
  file_proof     String?

  Sumdan   Sumdan  @relation(fields: [sumdanId], references: [id])
  sumdanId String
  Dapem    Dapem[]

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
}

model Pelunasan {
  id             String    @id
  nominal        Int       @default(0)
  nominal_sumdan Int       @default(0)
  file_pelunasan String?
  file_proof     String?
  pelunasan_date DateTime?
  alasan         String
  keterangan     String?

  jaminan_status EStatusBerkas @default(SUMDAN)
  final_status   EStatusFinal  @default(PENDING)

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Dapem      Dapem    @relation(fields: [dapemId], references: [id])
  dapemId    String   @unique
}

model AgentFronting {
  id          String  @id
  name        String
  code        String?
  fee         Int
  file_pks    String?
  description String?

  status     Boolean
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Dapems     Dapem[]
  Users      User[]
}
